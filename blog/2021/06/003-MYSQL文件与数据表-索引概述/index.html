<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>MySql文件与数据表、索引概述 | devsong's website</title> <meta name="author" content="guan zhisong"/> <meta name="description" content="记录日常学习的代码、问题以及个人对相关技术的一些思考与见解 "/> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"/> <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚛️</text></svg>"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://devsong.github.io/blog/2021/06/003-MYSQL%E6%96%87%E4%BB%B6%E4%B8%8E%E6%95%B0%E6%8D%AE%E8%A1%A8-%E7%B4%A2%E5%BC%95%E6%A6%82%E8%BF%B0/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">devsong's website</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">关于</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">博客<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">github</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">个人简介</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">MySql文件与数据表、索引概述</h1> <p class="post-meta">June 5, 2021</p> <p class="post-tags"> <a href="/blog/2021"> <i class="fas fa-calendar fa-sm"></i> 2021 </a>   ·   <a href="/blog/tag/blogs"> <i class="fas fa-hashtag fa-sm"></i> blogs</a>   <a href="/blog/tag/mysql"> <i class="fas fa-hashtag fa-sm"></i> mysql</a>   <a href="/blog/tag/innodb"> <i class="fas fa-hashtag fa-sm"></i> innodb</a>     ·   <a href="/blog/category/blogs"> <i class="fas fa-tag fa-sm"></i> blogs</a>   </p> </header> <article class="post-content"> <h2 id="mysql文件与数据表索引概述">MYSQL文件与数据表、索引概述</h2> <p>mysql作为操作系统的一个进程,与普通的进程并无二致,影响MySql系统整体性能的两个关键因素是内存和硬盘的读写速度，这也是为什么在存储体系那一小节中介绍内存和硬盘的原因，实际上大多数应用均受这两个因素的影响，对于服务端的程序来讲,基本上都需要与这两个物理存储元器件打交道</p> <p>下面我们来详细了解下mysql的文件目录结构(具体的mysql安装可自行参考官网或者google,此处略去不表)，所用的mysql为5.7.32版本</p> <p>文件目录结构见下图:</p> <p><img src="/assets/img/mysql/mysql_files_arch.png" width="760" alt="mysql_files_arch.png"></p> <p>以pem结尾的文件可以暂时先略过,重要的几个文件/目录说明如下:</p> <ul> <li>mysql mysql数据库系统核心数据库目录,包含用户、授权等数据表均位于次,可以理解为系统数据库</li> <li>performance_schema 系统性能监控,与innodb存储引擎相关的的基本都在这个schema下</li> <li>sys mysql系统数据库</li> <li>test 一个测试数据库</li> <li>ib_buff_pool innodb buffer pool持久化文件</li> <li>ib_logfile0/ib_logfile1 innodb日志文件组</li> <li>ibdata1 innodb系统(共享)表空间文件(innodb核心的文件)</li> <li>ibtmp1 innodb 临时表空间文件</li> <li>xx.local.err mysql错误日志文件,通常启动问题、系统异常问题首要排查的文件</li> <li>xx.local.pid mysql进程pid文件</li> </ul> <p><strong>基本概念</strong></p> <ul> <li>表 mysql中最常见的就是表了,开发人员针对特定数据划分一个一个集合组合成一张张特定表,如订单表、用户表、商品表等</li> <li>列 一张表由多列数据(字段)组成</li> <li>行 表的数据按行存储,一张表有多行构成</li> </ul> <p>一个表示例如下:</p> <p><img src="/assets/img/mysql/mysql_table_base.jpeg" width="760" alt="mysql_table_base.jpeg"></p> <p>对于关系型数据库来讲,我们定位数据的方式通常是<strong>表名-&gt;行号-&gt;列名</strong>(行式数据库)的方式来具体定位某一个字段</p> <p><strong>tips</strong>:近些年流行起来的NoSQL数据库很多都是<strong>列式</strong>数据库，相对于行式数据库,数据按列存储</p> <p>Mysql常用的存储引擎有Myisam、Innodb,从5.5.5开始Innodb替代Myisam成为mysql的默认存储引擎,大致介绍下这两种存储引擎的区别</p> <ul> <li>Myisam简易结构如下:</li> </ul> <p><img src="/assets/img/mysql/mysql_myisam_base.png" width="760" alt="mysql_myisam_base.png"></p> <p>​数据按照写入的顺序存放,由系统生成RowId,主键索引与普通的索引并无特别大的区别,均指向RowId,底层数据分为数据文件(MYD后缀)和索引文件(MYI)</p> <ul> <li>Innodb索引组织表,可以简单看成在isam结构的基础上,将RowId提取为主键,数据按主键的顺序存放(可以类比为学生时代新华字典,主键即是页码,拼音、偏旁为两个辅助索引,实际上大部分介绍数据库索引入门的文章都会拿字典来举例),底层数据文件为ibd数据文件</li> </ul> <p>myisam与innodb均使用B+树索引结构,在数据查询过程上并无特别大的区别,均需要从B+树根节点开始进行查找,二者的辅助(二级)索引查找过程是相同的,不同的是innodb的主键查找叶子结点存放的就是数据，对于主键类型的查找，无需在回表查询。</p> <p>早期后端开发领域流行一条SQL开发规范,相信不少人应该听过”业务系统在设计上主键应该是业务无关的,由系统生成维护”这样的论调,应用系统代码使用的字段(诸如order_id,user_id)实际均为辅助索引,私以为这条规则已经不适合于目前大型的互联网后端应用了,白白浪费了主键查找速度上的优势,具体可以参见上述的主键索引与二级索引查找过程中的区别</p> <p>以一个测试数据表为实例简要说明下数据定位的过程,测试建表语句如下</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td> <td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`user_info`</span> <span class="p">(</span>
  <span class="nv">`id`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span> <span class="k">COMMENT</span> <span class="s1">'主键ID'</span><span class="p">,</span>
  <span class="nv">`name`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'名称'</span><span class="p">,</span>
  <span class="nv">`phone`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'手机'</span><span class="p">,</span>
  <span class="nv">`email`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">''</span> <span class="k">COMMENT</span> <span class="s1">'邮箱'</span><span class="p">,</span>
  <span class="nv">`create_time`</span> <span class="nb">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'创建时间'</span><span class="p">,</span>
  <span class="nv">`update_time`</span> <span class="nb">timestamp</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">1</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8mb4</span>

</pre></td> </tr></tbody></table></code></pre></div></div> <p>以一个简单的查询语句举例:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td> <td class="rouge-code"><pre><span class="k">select</span> <span class="n">id</span><span class="p">,</span><span class="n">name</span> <span class="k">from</span> <span class="n">user_info</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> 
</pre></td> </tr></tbody></table></code></pre></div></div> <ul> <li>from后接表名(user_info)定位到具体的表(对应磁盘存储设备上的表空间文件)</li> <li>id=1 B+树索引查找定位到具体的某一行(主索引查找(通常会产生磁盘IO))</li> <li>id,name 定位到指定行的具体列(页查找,位于内存)</li> </ul> </article> </div> <style>table{border-left:1px solid #000;border-top:1px solid #000;width:100%;word-wrap:break-word;word-break:break-all}table th{text-align:left;min-width:60px;max-width:300px}table th,td{border-right:1px solid #000;border-bottom:1px solid #000}</style> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 guan zhisong. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/devsong/devsong.github.io" target="_blank" rel="noopener noreferrer">devsong.github.io</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="noopener noreferrer">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script type="text/javascript">$(function(){$('[data-toggle="tooltip"]').tooltip()});</script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>