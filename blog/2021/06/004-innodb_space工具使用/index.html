<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Innodb_space工具使用 | devsong's website</title> <meta name="author" content="guan zhisong"/> <meta name="description" content="记录日常学习的代码、问题以及个人对相关技术的一些思考与见解 "/> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"/> <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚛️</text></svg>"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://devsong.github.io/blog/2021/06/004-innodb_space%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">devsong's website</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">关于</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">博客<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">github</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">个人简介</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Innodb_space工具使用</h1> <p class="post-meta">June 5, 2021</p> <p class="post-tags"> <a href="/blog/2021"> <i class="fas fa-calendar fa-sm"></i> 2021 </a>   ·   <a href="/blog/tag/blogs"> <i class="fas fa-hashtag fa-sm"></i> blogs</a>   <a href="/blog/tag/mysql"> <i class="fas fa-hashtag fa-sm"></i> mysql</a>   <a href="/blog/tag/innodb"> <i class="fas fa-hashtag fa-sm"></i> innodb</a>   <a href="/blog/tag/innodb-space"> <i class="fas fa-hashtag fa-sm"></i> innodb_space</a>     ·   <a href="/blog/category/blogs"> <i class="fas fa-tag fa-sm"></i> blogs</a>   </p> </header> <article class="post-content"> <h4 id="innodb表空间辅助工具使用">Innodb表空间辅助工具使用</h4> <ul> <li> <p>工具1 innodb_space 功能强大,以更直观的方式分析表空间文件,github地址:<a href="https://github.com/jeremycole/innodb_ruby" target="_blank" rel="noopener noreferrer">https://github.com/jeremycole/innodb_ruby</a></p> </li> <li> <p>工具2 py_innodb_page_info,msyql技术内幕存储引擎-Innodb技术内幕一书中使用的工具,能够分析ibd文件 github地址:<a href="https://github.com/happieme/py_innodb_page_info" target="_blank" rel="noopener noreferrer">https://github.com/happieme/py_innodb_page_info</a></p> </li> </ul> <h4 id="概念说明">概念说明:</h4> <ul> <li> <p>表/表空间:在开启了<code class="language-plaintext highlighter-rouge">innodb_file_per_table=1</code>后,每张表对应一个独立的表空间文件，</p> <p>查询具体的表所属的表空间Id可以执行</p> <div class="language-sql highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td> <td class="rouge-code"><pre>  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">innodb_sys_tablespaces</span> <span class="k">WHERE</span> <span class="n">name</span> <span class="k">LIKE</span> <span class="s1">'%user_info%'</span><span class="p">;</span>
</pre></td> </tr></tbody></table></code></pre></div> </div> <p>输出</p> <div class="language-sql highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td> <td class="rouge-code"><pre>  <span class="o">+</span><span class="c1">-------+-----------------+------+-------------+------------+-----------+---------------+------------+---------------+-----------+----------------+</span>
  <span class="o">|</span> <span class="k">SPACE</span> <span class="o">|</span> <span class="n">NAME</span>            <span class="o">|</span> <span class="n">FLAG</span> <span class="o">|</span> <span class="n">FILE_FORMAT</span> <span class="o">|</span> <span class="n">ROW_FORMAT</span> <span class="o">|</span> <span class="n">PAGE_SIZE</span> <span class="o">|</span> <span class="n">ZIP_PAGE_SIZE</span> <span class="o">|</span> <span class="n">SPACE_TYPE</span> <span class="o">|</span> <span class="n">FS_BLOCK_SIZE</span> <span class="o">|</span> <span class="n">FILE_SIZE</span> <span class="o">|</span> <span class="n">ALLOCATED_SIZE</span> <span class="o">|</span>
  <span class="o">+</span><span class="c1">-------+-----------------+------+-------------+------------+-----------+---------------+------------+---------------+-----------+----------------+</span>
  <span class="o">|</span>    <span class="mi">33</span> <span class="o">|</span> <span class="n">test</span><span class="o">/</span><span class="n">user_info</span>  <span class="o">|</span>   <span class="mi">33</span> <span class="o">|</span> <span class="n">Barracuda</span>   <span class="o">|</span> <span class="k">Dynamic</span>    <span class="o">|</span>     <span class="mi">16384</span> <span class="o">|</span>             <span class="mi">0</span> <span class="o">|</span> <span class="n">Single</span>     <span class="o">|</span>          <span class="mi">4096</span> <span class="o">|</span>    <span class="mi">114688</span> <span class="o">|</span>         <span class="mi">114688</span> <span class="o">|</span>
  <span class="o">|</span>    <span class="mi">34</span> <span class="o">|</span> <span class="n">test</span><span class="o">/</span><span class="n">user_info2</span> <span class="o">|</span>   <span class="mi">33</span> <span class="o">|</span> <span class="n">Barracuda</span>   <span class="o">|</span> <span class="k">Dynamic</span>    <span class="o">|</span>     <span class="mi">16384</span> <span class="o">|</span>             <span class="mi">0</span> <span class="o">|</span> <span class="n">Single</span>     <span class="o">|</span>          <span class="mi">4096</span> <span class="o">|</span> <span class="mi">360710144</span> <span class="o">|</span>      <span class="mi">370147328</span> <span class="o">|</span>
  <span class="o">+</span><span class="c1">-------+-----------------+------+-------------+------------+-----------+---------------+------------+---------------+-----------+----------------+</span>
</pre></td> </tr></tbody></table></code></pre></div> </div> <p>输出中的space列即为对应表空间ID</p> </li> <li> <p>表ID、索引ID: 表是一个应用存储逻辑数据的基本单位,innodb是索引组织表,数据即索引,索引也是数据的一部分,一张表从逻辑上可以划分为由多个索引构成,系统为每个表、每个表中的索引生成一个唯一的ID</p> <ul> <li>查看表ID:</li> </ul> <div class="language-sql highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td> <td class="rouge-code"><pre>  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">innodb_sys_tables</span> <span class="k">WHERE</span> <span class="n">name</span> <span class="k">LIKE</span> <span class="s1">'%user_info%'</span><span class="p">;</span>
</pre></td> </tr></tbody></table></code></pre></div> </div> <p>输出</p> <div class="language-sql highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td> <td class="rouge-code"><pre>  <span class="o">+</span><span class="c1">----------+-----------------+------+--------+-------+-------------+------------+---------------+------------+</span>
  <span class="o">|</span> <span class="n">TABLE_ID</span> <span class="o">|</span> <span class="n">NAME</span>            <span class="o">|</span> <span class="n">FLAG</span> <span class="o">|</span> <span class="n">N_COLS</span> <span class="o">|</span> <span class="k">SPACE</span> <span class="o">|</span> <span class="n">FILE_FORMAT</span> <span class="o">|</span> <span class="n">ROW_FORMAT</span> <span class="o">|</span> <span class="n">ZIP_PAGE_SIZE</span> <span class="o">|</span> <span class="n">SPACE_TYPE</span> <span class="o">|</span>
  <span class="o">+</span><span class="c1">----------+-----------------+------+--------+-------+-------------+------------+---------------+------------+</span>
  <span class="o">|</span>       <span class="mi">55</span> <span class="o">|</span> <span class="n">test</span><span class="o">/</span><span class="n">user_info</span>  <span class="o">|</span>   <span class="mi">33</span> <span class="o">|</span>      <span class="mi">9</span> <span class="o">|</span>    <span class="mi">33</span> <span class="o">|</span> <span class="n">Barracuda</span>   <span class="o">|</span> <span class="k">Dynamic</span>    <span class="o">|</span>             <span class="mi">0</span> <span class="o">|</span> <span class="n">Single</span>     <span class="o">|</span>
  <span class="o">|</span>       <span class="mi">56</span> <span class="o">|</span> <span class="n">test</span><span class="o">/</span><span class="n">user_info2</span> <span class="o">|</span>   <span class="mi">33</span> <span class="o">|</span>      <span class="mi">9</span> <span class="o">|</span>    <span class="mi">34</span> <span class="o">|</span> <span class="n">Barracuda</span>   <span class="o">|</span> <span class="k">Dynamic</span>    <span class="o">|</span>             <span class="mi">0</span> <span class="o">|</span> <span class="n">Single</span>     <span class="o">|</span>
  <span class="o">+</span><span class="c1">----------+-----------------+------+--------+-------+-------------+------------+---------------+------------+</span>
</pre></td> </tr></tbody></table></code></pre></div> </div> <p>table_id即为表ID,可以看到输出列中还有一个space字段,此此段即为数据表对应的表空间ID</p> <ul> <li>查看索引ID</li> </ul> <div class="language-sql highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td> <td class="rouge-code"><pre>  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">innodb_sys_indexes</span> <span class="k">WHERE</span> <span class="n">table_id</span><span class="o">=</span><span class="mi">55</span><span class="p">;</span>
</pre></td> </tr></tbody></table></code></pre></div> </div> <p>输出</p> <div class="language-sql highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td> <td class="rouge-code"><pre>  <span class="o">+</span><span class="c1">----------+-----------+----------+------+----------+---------+-------+-----------------+</span>
  <span class="o">|</span> <span class="n">INDEX_ID</span> <span class="o">|</span> <span class="n">NAME</span>      <span class="o">|</span> <span class="n">TABLE_ID</span> <span class="o">|</span> <span class="k">TYPE</span> <span class="o">|</span> <span class="n">N_FIELDS</span> <span class="o">|</span> <span class="n">PAGE_NO</span> <span class="o">|</span> <span class="k">SPACE</span> <span class="o">|</span> <span class="n">MERGE_THRESHOLD</span> <span class="o">|</span>
  <span class="o">+</span><span class="c1">----------+-----------+----------+------+----------+---------+-------+-----------------+</span>
  <span class="o">|</span>       <span class="mi">44</span> <span class="o">|</span> <span class="k">PRIMARY</span>   <span class="o">|</span>       <span class="mi">55</span> <span class="o">|</span>    <span class="mi">3</span> <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>       <span class="mi">3</span> <span class="o">|</span>    <span class="mi">33</span> <span class="o">|</span>              <span class="mi">50</span> <span class="o">|</span>
  <span class="o">|</span>       <span class="mi">50</span> <span class="o">|</span> <span class="n">idx_phone</span> <span class="o">|</span>       <span class="mi">55</span> <span class="o">|</span>    <span class="mi">0</span> <span class="o">|</span>        <span class="mi">1</span> <span class="o">|</span>       <span class="mi">4</span> <span class="o">|</span>    <span class="mi">33</span> <span class="o">|</span>              <span class="mi">50</span> <span class="o">|</span>
  <span class="o">+</span><span class="c1">----------+-----------+----------+------+----------+---------+-------+-----------------+</span>
</pre></td> </tr></tbody></table></code></pre></div> </div> <p>index_id 即为索引ID,table_id、space为对应的表ID、表空间ID</p> </li> </ul> <h4 id="测试表建表语句">测试表建表语句</h4> <ul> <li> <p>表1 user_info</p> <div class="language-sql highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td> <td class="rouge-code"><pre>  <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`user_info`</span> <span class="p">(</span>
    <span class="nv">`id`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span> <span class="k">COMMENT</span> <span class="s1">'主键ID'</span><span class="p">,</span>
    <span class="nv">`name`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'名称'</span><span class="p">,</span>
    <span class="nv">`phone`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'手机'</span><span class="p">,</span>
    <span class="nv">`email`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">''</span> <span class="k">COMMENT</span> <span class="s1">'邮箱'</span><span class="p">,</span>
    <span class="nv">`create_time`</span> <span class="nb">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'创建时间'</span><span class="p">,</span>
    <span class="nv">`update_time`</span> <span class="nb">timestamp</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">),</span>
    <span class="k">KEY</span> <span class="nv">`idx_phone`</span> <span class="p">(</span><span class="nv">`phone`</span><span class="p">)</span>
  <span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8mb4</span><span class="p">;</span>
</pre></td> </tr></tbody></table></code></pre></div> </div> </li> <li> <p>表2 user_info2</p> <div class="language-sql highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td> <td class="rouge-code"><pre>  <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`user_info2`</span> <span class="p">(</span>
    <span class="nv">`id`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span> <span class="k">COMMENT</span> <span class="s1">'主键ID'</span><span class="p">,</span>
    <span class="nv">`name`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'名称'</span><span class="p">,</span>
    <span class="nv">`phone`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'手机'</span><span class="p">,</span>
    <span class="nv">`email`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">''</span> <span class="k">COMMENT</span> <span class="s1">'邮箱'</span><span class="p">,</span>
    <span class="nv">`create_time`</span> <span class="nb">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'创建时间'</span><span class="p">,</span>
    <span class="nv">`update_time`</span> <span class="nb">timestamp</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">),</span>
    <span class="k">KEY</span> <span class="nv">`idx_phone`</span> <span class="p">(</span><span class="nv">`phone`</span><span class="p">)</span>
  <span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">2484014</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8mb4</span><span class="p">;</span>
</pre></td> </tr></tbody></table></code></pre></div> </div> </li> <li> <p>表1与表2结构一样,不同的是两表数据量不一样,本地表2数据量在240w左右,为后续内容作准备</p> </li> </ul> <h4 id="生成测试数据的mysql函数存储过程">生成测试数据的mysql函数/存储过程</h4> <ul> <li> <p>随机数函数</p> <div class="language-sql highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td> <td class="rouge-code"><pre>  <span class="k">drop</span> <span class="k">function</span> <span class="n">if</span> <span class="k">exists</span> <span class="nv">`rand_number`</span><span class="p">;</span>
  <span class="k">delimiter</span> <span class="err">$$</span>
  <span class="k">create</span> <span class="k">function</span> <span class="nv">`rand_number`</span><span class="p">(</span><span class="n">n</span> <span class="nb">int</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="n">charset</span> <span class="n">utf8mb4</span> <span class="k">no</span> <span class="k">sql</span>
  <span class="k">begin</span>        
      <span class="k">declare</span> <span class="n">chars_str</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>  <span class="k">default</span> <span class="nv">"0123456789"</span><span class="p">;</span>
      <span class="k">declare</span> <span class="n">return_str</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">default</span> <span class="nv">""</span><span class="p">;</span>        
      <span class="k">declare</span> <span class="n">i</span> <span class="nb">int</span> <span class="k">default</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="k">do</span>        
      <span class="k">set</span> <span class="n">return_str</span><span class="o">=</span><span class="n">concat</span><span class="p">(</span><span class="n">return_str</span><span class="p">,</span><span class="k">substring</span><span class="p">(</span><span class="n">chars_str</span><span class="p">,</span><span class="n">floor</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">rand</span><span class="p">()</span><span class="o">*</span><span class="mi">10</span><span class="p">),</span><span class="mi">1</span><span class="p">));</span>
      <span class="k">set</span> <span class="n">i</span><span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>        
      <span class="k">end</span> <span class="n">while</span><span class="p">;</span>        
    <span class="k">return</span> <span class="n">return_str</span><span class="p">;</span>    
  <span class="k">end</span> <span class="err">$$</span>
  <span class="k">delimiter</span> <span class="p">;</span>
	
</pre></td> </tr></tbody></table></code></pre></div> </div> </li> <li> <p>生成随机字符串函数</p> <div class="language-sql highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td> <td class="rouge-code"><pre>  <span class="k">drop</span> <span class="k">function</span> <span class="n">if</span> <span class="k">exists</span> <span class="nv">`rand_string`</span><span class="p">;</span>
  <span class="k">delimiter</span> <span class="err">$$</span>
  <span class="k">create</span> <span class="k">function</span> <span class="nv">`rand_string`</span><span class="p">(</span><span class="n">n</span> <span class="nb">int</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="n">charset</span> <span class="n">utf8mb4</span> <span class="k">no</span> <span class="k">sql</span>
  <span class="k">begin</span>        
    <span class="k">declare</span> <span class="n">chars_str</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> 
    <span class="k">default</span> <span class="nv">"abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz0123456789"</span><span class="p">;</span>
    <span class="k">declare</span> <span class="n">return_str</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">default</span> <span class="nv">""</span><span class="p">;</span>        
    <span class="k">declare</span> <span class="n">i</span> <span class="nb">int</span> <span class="k">default</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="k">do</span>        
        <span class="k">set</span> <span class="n">return_str</span><span class="o">=</span><span class="n">concat</span><span class="p">(</span><span class="n">return_str</span><span class="p">,</span><span class="k">substring</span><span class="p">(</span><span class="n">chars_str</span><span class="p">,</span><span class="n">floor</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">rand</span><span class="p">()</span><span class="o">*</span><span class="mi">62</span><span class="p">),</span><span class="mi">1</span><span class="p">));</span>
        <span class="k">set</span> <span class="n">i</span><span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>        
    <span class="k">end</span> <span class="n">while</span><span class="p">;</span>        
    <span class="k">return</span> <span class="n">return_str</span><span class="p">;</span>    
  <span class="k">end</span> <span class="err">$$</span>
  <span class="k">delimiter</span> <span class="p">;</span>
</pre></td> </tr></tbody></table></code></pre></div> </div> </li> <li> <p>生成测试数据的存储过程</p> <div class="language-sql highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td> <td class="rouge-code"><pre>  <span class="k">drop</span> <span class="k">procedure</span> <span class="n">if</span> <span class="k">exists</span> <span class="nv">`insert_user_info_data`</span><span class="p">;</span>
  <span class="k">delimiter</span> <span class="err">$$</span>
  <span class="k">create</span>  <span class="k">procedure</span> <span class="nv">`insert_user_info_data`</span><span class="p">(</span><span class="k">in</span> <span class="n">n</span> <span class="nb">int</span><span class="p">)</span> <span class="k">deterministic</span>
  <span class="k">begin</span>  
      <span class="k">declare</span> <span class="n">i</span> <span class="nb">int</span> <span class="k">default</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">declare</span> <span class="n">start_create_time</span> <span class="nb">datetime</span> <span class="k">default</span> <span class="n">now</span><span class="p">();</span>
      <span class="k">declare</span> <span class="n">sec</span> <span class="nb">int</span> <span class="k">default</span> <span class="o">-</span><span class="mi">30</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">3600</span><span class="p">;</span>
	
      <span class="k">set</span> <span class="n">autocommit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">)</span> <span class="k">do</span>
          <span class="k">set</span> <span class="n">sec</span><span class="o">=</span><span class="n">sec</span><span class="o">+</span><span class="mi">2</span><span class="p">;</span>
          <span class="k">insert</span> <span class="k">into</span> <span class="n">user_info</span> 
          <span class="p">(</span><span class="nv">`name`</span><span class="p">,</span><span class="nv">`phone`</span><span class="p">,</span><span class="nv">`email`</span><span class="p">,</span><span class="nv">`create_time`</span><span class="p">,</span><span class="nv">`update_time`</span><span class="p">)</span> 
          <span class="k">values</span> 
          <span class="p">(</span><span class="n">rand_string</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="n">rand_number</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span><span class="n">rand_string</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="p">,</span><span class="n">date_add</span><span class="p">(</span><span class="n">start_create_time</span><span class="p">,</span><span class="n">interval</span> <span class="n">sec</span> <span class="k">second</span><span class="p">),</span><span class="n">date_add</span><span class="p">(</span><span class="n">start_create_time</span><span class="p">,</span><span class="n">interval</span> <span class="n">sec</span> <span class="k">second</span><span class="p">))</span> <span class="p">;</span>
          <span class="n">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">100</span><span class="o">=</span><span class="mi">0</span> <span class="k">then</span>
              <span class="c1">-- 500条提交一次</span>
              <span class="k">commit</span><span class="p">;</span>
          <span class="k">end</span> <span class="n">if</span><span class="p">;</span>
          <span class="k">set</span> <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="p">;</span>
      <span class="k">end</span> <span class="n">while</span> <span class="p">;</span>
      <span class="c1">-- 提交剩余的</span>
      <span class="k">commit</span> <span class="p">;</span>
      <span class="k">set</span> <span class="n">autocommit</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">end</span> <span class="err">$$</span>
  <span class="k">delimiter</span> <span class="p">;</span>
</pre></td> </tr></tbody></table></code></pre></div> </div> </li> </ul> <h4 id="py_innodb_page_info使用方法">py_innodb_page_info使用方法</h4> <ul> <li> <p>命令别名</p> <div class="language-sh highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td> <td class="rouge-code"><pre>  <span class="nb">export </span><span class="nv">PYTHONPATH</span><span class="o">=</span>/yourpath/py_innodb_page_info/
  <span class="nb">alias </span><span class="nv">mysql_page_info</span><span class="o">=</span><span class="s2">"python /yourpath/py_innodb_page_info/py_innodb_page_info.py"</span>
</pre></td> </tr></tbody></table></code></pre></div> </div> <p>需要本地有python环境,我这本地做了一个alias的别名处理，方便后续不用敲全名,将对应的路径替换为各自的安装路径即可,执行上述存储过程<code class="language-plaintext highlighter-rouge">call insert_user_info_data(5)</code>生成5条测试数据</p> </li> <li> <p>基本用法,查看数据页统计信息</p> <div class="language-sh highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td> <td class="rouge-code"><pre>  mysql_page_info <span class="nb">test</span>/user_info.ibd
</pre></td> </tr></tbody></table></code></pre></div> </div> <p>输出如下:</p> <div class="language-sh highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td> <td class="rouge-code"><pre>  Total number of page: 7:
  Insert Buffer Bitmap: 1
  File Space Header: 1
  B-tree Node: 4
  File Segment inode: 1
</pre></td> </tr></tbody></table></code></pre></div> </div> <p>释义</p> <ul> <li>Total number of page: 当前表空间数据页数量</li> <li>Insert Buffer Bitmap: 插入缓冲位图数据页数量</li> <li>File Space Header: 文件头数据页数量</li> <li>B-tree Node: B树节点数据页数量</li> <li>File Segment inode: 段描述页数量</li> </ul> <p>接<strong>-v</strong>参数显示明细信息:</p> <div class="language-sh highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td> <td class="rouge-code"><pre>  mysql_page_info <span class="nb">test</span>/user_info.ibd <span class="nt">-v</span>
</pre></td> </tr></tbody></table></code></pre></div> </div> <p>输出如下:</p> <div class="language-sh highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td> <td class="rouge-code"><pre>  page offset 00000000, page <span class="nb">type</span> &lt;File Space Header&gt;
  page offset 00000001, page <span class="nb">type</span> &lt;Insert Buffer Bitmap&gt;
  page offset 00000002, page <span class="nb">type</span> &lt;File Segment inode&gt;
  page offset 00000003, page <span class="nb">type</span> &lt;B-tree Node&gt;, page level &lt;0000&gt;
  page offset 00000004, page <span class="nb">type</span> &lt;B-tree Node&gt;, page level &lt;0000&gt;
  page offset 00000005, page <span class="nb">type</span> &lt;B-tree Node&gt;, page level &lt;0000&gt;
  page offset 00000006, page <span class="nb">type</span> &lt;B-tree Node&gt;, page level &lt;0000&gt;
  Total number of page: 7
  Insert Buffer Bitmap: 1
  File Space Header: 1
  B-tree Node: 4
  File Segment inode: 1
</pre></td> </tr></tbody></table></code></pre></div> </div> <p>可以看到添加<strong>-v</strong>参数后打印出了数据页的编号以及每个数据的描述信息</p> </li> </ul> <h4 id="innodb_space常用命令">innodb_space常用命令</h4> <p>下面对innodb_space工具常用的功能做一个说明(详细用法可参见官方wiki页面,链接见头部github仓库地址)</p> <ul> <li> <p>列出数据表的索引信息</p> <div class="language-sh highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td> <td class="rouge-code"><pre>  innodb_space <span class="nt">-s</span> ibdata1 <span class="nt">-T</span> <span class="nb">test</span>/user_info space-indexes
</pre></td> </tr></tbody></table></code></pre></div> </div> <p>输出:</p> <div class="language-sh highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td> <td class="rouge-code"><pre>  <span class="nb">id          </span>name                            root        fseg        fseg_id     used        allocated   fill_factor
  44          PRIMARY                         3           internal    1           1           1           100.00%
  44          PRIMARY                         3           leaf        2           0           0           0.00%
  50          idx_phone                       4           internal    3           1           1           100.00%
  50          idx_phone                       4           leaf        4           0           0           0.00%
</pre></td> </tr></tbody></table></code></pre></div> </div> <p>释义</p> <ul> <li>id:索引ID列,参见上述索引ID</li> <li>name 索引名称列</li> <li>root 索引根节点位于的数据页编号(数据页概念后续会详细说明)</li> <li>fseg 索引类型(internal为非叶节点,leaf为叶节点)</li> <li>fseg_id 索引所属段ID(段的概念后续会说明)</li> <li>used 使用的page页数量</li> <li>allocated 申请的数据页数量</li> <li>fill_factor used/allocated 索引页使用百分比</li> </ul> </li> <li>统计表空间中各页类型占比 <div class="language-sh highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td> <td class="rouge-code"><pre>  innodb_space <span class="nt">-s</span> ibdata1 <span class="nt">-T</span> <span class="nb">test</span>/user_info space-page-type-summary
</pre></td> </tr></tbody></table></code></pre></div> </div> <p>输出:</p> <div class="language-sh highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td> <td class="rouge-code"><pre>  <span class="nb">type                </span>count       percent     description
  INDEX               4           57.14       B+Tree index
  FSP_HDR             1           14.29       File space header
  IBUF_BITMAP         1           14.29       Insert buffer bitmap
  INODE               1           14.29       File segment inode
</pre></td> </tr></tbody></table></code></pre></div> </div> <p>释义</p> <ul> <li>type 页类型</li> <li>count 数量</li> <li>percent 占比</li> <li>description 页的基本描述信息</li> </ul> </li> <li> <p>dump page数据页详细信息</p> <div class="language-sh highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td> <td class="rouge-code"><pre>  innodb_space <span class="nt">-s</span> ibdata1 <span class="nt">-T</span> <span class="nb">test</span>/user_info <span class="nt">-p</span> 3 page-dump
</pre></td> </tr></tbody></table></code></pre></div> </div> <p>输出内容较多,此处只粘贴部分输出</p> <div class="language-sh highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
</pre></td> <td class="rouge-code"><pre>   fil header:
   <span class="o">{</span>:checksum<span class="o">=&gt;</span>1959780131,
    :offset<span class="o">=&gt;</span>3,
    :prev<span class="o">=&gt;</span>nil,
    :next<span class="o">=&gt;</span>nil,
    :lsn<span class="o">=&gt;</span>20426510,
    :type<span class="o">=&gt;</span>:INDEX,
    :flush_lsn<span class="o">=&gt;</span>0,
    :space_id<span class="o">=&gt;</span>33<span class="o">}</span>
	
   fil trailer:
   <span class="o">{</span>:checksum<span class="o">=&gt;</span>1959780131, :lsn_low32<span class="o">=&gt;</span>20426510<span class="o">}</span>
	
   page header:
   <span class="o">{</span>:n_dir_slots<span class="o">=&gt;</span>2,
    :heap_top<span class="o">=&gt;</span>565,
    :garbage_offset<span class="o">=&gt;</span>0,
    :garbage_size<span class="o">=&gt;</span>0,
    :last_insert_offset<span class="o">=&gt;</span>484,
    :direction<span class="o">=&gt;</span>:right,
    :n_direction<span class="o">=&gt;</span>4,
    :n_recs<span class="o">=&gt;</span>5,
    :max_trx_id<span class="o">=&gt;</span>0,
    :level<span class="o">=&gt;</span>0,
    :index_id<span class="o">=&gt;</span>44,
    :n_heap<span class="o">=&gt;</span>7,
    :format<span class="o">=&gt;</span>:compact<span class="o">}</span>
	
   fseg header:
   <span class="o">{</span>:leaf<span class="o">=&gt;</span>
     &lt;Innodb::Inode <span class="nv">space</span><span class="o">=</span>&lt;Innodb::Space <span class="nv">file</span><span class="o">=</span><span class="s2">"test/user_info.ibd"</span>, <span class="nv">page_size</span><span class="o">=</span>16384, <span class="nv">pages</span><span class="o">=</span>7&gt;, <span class="nv">fseg</span><span class="o">=</span>2&gt;,
    :internal<span class="o">=&gt;</span>
     &lt;Innodb::Inode <span class="nv">space</span><span class="o">=</span>&lt;Innodb::Space <span class="nv">file</span><span class="o">=</span><span class="s2">"test/user_info.ibd"</span>, <span class="nv">page_size</span><span class="o">=</span>16384, <span class="nv">pages</span><span class="o">=</span>7&gt;, <span class="nv">fseg</span><span class="o">=</span>1&gt;<span class="o">}</span>
	
   sizes:
     header           120
     trailer            8
     directory          4
     free           15807
     used             577
     record           445
     per record     89.00
	
   page directory:
   <span class="o">[</span>99, 112]
	 
   system records:
   <span class="o">{</span>:offset<span class="o">=&gt;</span>99,
    :header<span class="o">=&gt;</span>
     <span class="o">{</span>:next<span class="o">=&gt;</span>128,
      :type<span class="o">=&gt;</span>:infimum,
      :heap_number<span class="o">=&gt;</span>0,
      :n_owned<span class="o">=&gt;</span>1,
      :min_rec<span class="o">=&gt;</span><span class="nb">false</span>,
      :deleted<span class="o">=&gt;</span><span class="nb">false</span>,
      :length<span class="o">=&gt;</span>5<span class="o">}</span>,
    :next<span class="o">=&gt;</span>128,
    :data<span class="o">=&gt;</span><span class="s2">"infimum</span><span class="se">\x</span><span class="s2">00"</span>,
    :length<span class="o">=&gt;</span>8<span class="o">}</span>
   <span class="o">{</span>:offset<span class="o">=&gt;</span>112,
    :header<span class="o">=&gt;</span>
     <span class="o">{</span>:next<span class="o">=&gt;</span>112,
      :type<span class="o">=&gt;</span>:supremum,
      :heap_number<span class="o">=&gt;</span>1,
      :n_owned<span class="o">=&gt;</span>6,
      :min_rec<span class="o">=&gt;</span><span class="nb">false</span>,
      :deleted<span class="o">=&gt;</span><span class="nb">false</span>,
      :length<span class="o">=&gt;</span>5<span class="o">}</span>,
    :next<span class="o">=&gt;</span>112,
    :data<span class="o">=&gt;</span><span class="s2">"supremum"</span>,
    :length<span class="o">=&gt;</span>8<span class="o">}</span>
	
   garbage records:
		
      records:
   <span class="o">{</span>:format<span class="o">=&gt;</span>:compact,
    :offset<span class="o">=&gt;</span>128,
    :header<span class="o">=&gt;</span>
     <span class="o">{</span>:next<span class="o">=&gt;</span>217,
      :type<span class="o">=&gt;</span>:conventional,
      :heap_number<span class="o">=&gt;</span>2,
      :n_owned<span class="o">=&gt;</span>0,
      :min_rec<span class="o">=&gt;</span><span class="nb">false</span>,
      :deleted<span class="o">=&gt;</span><span class="nb">false</span>,
      :nulls<span class="o">=&gt;[]</span>,
      :lengths<span class="o">=&gt;{</span><span class="s2">"name"</span><span class="o">=&gt;</span>20, <span class="s2">"phone"</span><span class="o">=&gt;</span>11, <span class="s2">"email"</span><span class="o">=&gt;</span>20<span class="o">}</span>,
      :externs<span class="o">=&gt;[]</span>,
      :length<span class="o">=&gt;</span>8<span class="o">}</span>,
    :next<span class="o">=&gt;</span>217,
    :type<span class="o">=&gt;</span>:clustered,
    :key<span class="o">=&gt;[{</span>:name<span class="o">=&gt;</span><span class="s2">"id"</span>, :type<span class="o">=&gt;</span><span class="s2">"BIGINT UNSIGNED"</span>, :value<span class="o">=&gt;</span>1<span class="o">}]</span>,
    :row<span class="o">=&gt;</span>
     <span class="o">[{</span>:name<span class="o">=&gt;</span><span class="s2">"name"</span>, :type<span class="o">=&gt;</span><span class="s2">"VARCHAR(80)"</span>, :value<span class="o">=&gt;</span><span class="s2">"3i9izcwibfprwwkien9d"</span><span class="o">}</span>,
      <span class="o">{</span>:name<span class="o">=&gt;</span><span class="s2">"phone"</span>, :type<span class="o">=&gt;</span><span class="s2">"VARCHAR(120)"</span>, :value<span class="o">=&gt;</span><span class="s2">"33810132397"</span><span class="o">}</span>,
      <span class="o">{</span>:name<span class="o">=&gt;</span><span class="s2">"email"</span>, :type<span class="o">=&gt;</span><span class="s2">"VARCHAR(200)"</span>, :value<span class="o">=&gt;</span><span class="s2">"8gr4furgtsusl1g9zehy"</span><span class="o">}</span>,
      <span class="o">{</span>:name<span class="o">=&gt;</span><span class="s2">"create_time"</span>,
       :type<span class="o">=&gt;</span><span class="s2">"DATETIME"</span>,
       :value<span class="o">=&gt;</span><span class="s2">"184913550-53-57 17:81:33"</span><span class="o">}</span>,
      <span class="o">{</span>:name<span class="o">=&gt;</span><span class="s2">"update_time"</span>, :type<span class="o">=&gt;</span><span class="s2">"TIMESTAMP"</span>, :value<span class="o">=&gt;</span><span class="s2">"2003-01-02 09:49:08"</span><span class="o">}]</span>,
    :sys<span class="o">=&gt;</span>
     <span class="o">[{</span>:name<span class="o">=&gt;</span><span class="s2">"DB_TRX_ID"</span>, :type<span class="o">=&gt;</span><span class="s2">"TRX_ID"</span>, :value<span class="o">=&gt;</span>6660<span class="o">}</span>,
      <span class="o">{</span>:name<span class="o">=&gt;</span><span class="s2">"DB_ROLL_PTR"</span>,
       :type<span class="o">=&gt;</span><span class="s2">"ROLL_PTR"</span>,
       :value<span class="o">=&gt;</span>
        <span class="o">{</span>:is_insert<span class="o">=&gt;</span><span class="nb">true</span>, :rseg_id<span class="o">=&gt;</span>88, :undo_log<span class="o">=&gt;{</span>:page<span class="o">=&gt;</span>363, :offset<span class="o">=&gt;</span>272<span class="o">}}}]</span>,
    :length<span class="o">=&gt;</span>84,
    :transaction_id<span class="o">=&gt;</span>6660,
    :roll_pointer<span class="o">=&gt;</span>
     <span class="o">{</span>:is_insert<span class="o">=&gt;</span><span class="nb">true</span>, :rseg_id<span class="o">=&gt;</span>88, :undo_log<span class="o">=&gt;{</span>:page<span class="o">=&gt;</span>363, :offset<span class="o">=&gt;</span>272<span class="o">}}}</span>
	
</pre></td> </tr></tbody></table></code></pre></div> </div> <p>输出内容只粘贴了一条记录,亦即id=1的数据记录,具体数据页格式可以参考后续介绍</p> </li> <li> <p>dump页面中数据部分</p> <div class="language-sh highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td> <td class="rouge-code"><pre>  innodb_space <span class="nt">-s</span> ibdata1 <span class="nt">-T</span> <span class="nb">test</span>/user_info <span class="nt">-p</span> 3 page-records
</pre></td> </tr></tbody></table></code></pre></div> </div> <p>输出</p> <div class="language-sh highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td> <td class="rouge-code"><pre>  Record 128: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>1<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"3i9izcwibfprwwkien9d"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"33810132397"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"8gr4furgtsusl1g9zehy"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913550-53-57 17:81:33"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"2003-01-02 09:49:08"</span><span class="o">)</span>
  Record 217: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>2<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"kvgmqze5wbesshybyto6"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"04089308321"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"29usioj4yxcjygajkmqs"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913550-53-90 73:25:65"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"2004-01-25 18:29:40"</span><span class="o">)</span>
  Record 306: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>3<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"x00q4cllpawhlauwzcul"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"79622320564"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"yn9cpfqkwaxto6egwpke"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913550-54-24 28:69:97"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"2005-02-17 03:10:12"</span><span class="o">)</span>
  Record 395: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>4<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"3nytya2vhkh5aryjglxs"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"38082638449"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"rnvzgby9hq0jpxnqx3gy"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913550-54-57 84:14:29"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"2006-03-12 11:50:44"</span><span class="o">)</span>
  Record 484: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>5<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"utsj9ng19wzg8mj27j38"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"22472851323"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"w5rlnpmv2t997zr2lv6r"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913550-54-91 39:58:61"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"2007-03-20 15:38:40"</span><span class="o">)</span>
</pre></td> </tr></tbody></table></code></pre></div> </div> </li> <li> <p>遍历索引(索引扫描)</p> <p>主索引</p> <div class="language-sh highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td> <td class="rouge-code"><pre>  innodb_space <span class="nt">-s</span> ibdata1 <span class="nt">-T</span> <span class="nb">test</span>/user_info <span class="nt">-I</span> PRIMARY index-recurse
</pre></td> </tr></tbody></table></code></pre></div> </div> <p>输出</p> <div class="language-sh highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td> <td class="rouge-code"><pre>  RECORD: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>1<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"3i9izcwibfprwwkien9d"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"33810132397"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"8gr4furgtsusl1g9zehy"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913550-53-57 17:81:33"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"2003-01-02 09:49:08"</span><span class="o">)</span>
  RECORD: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>2<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"kvgmqze5wbesshybyto6"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"04089308321"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"29usioj4yxcjygajkmqs"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913550-53-90 73:25:65"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"2004-01-25 18:29:40"</span><span class="o">)</span>
  RECORD: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>3<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"x00q4cllpawhlauwzcul"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"79622320564"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"yn9cpfqkwaxto6egwpke"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913550-54-24 28:69:97"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"2005-02-17 03:10:12"</span><span class="o">)</span>
  RECORD: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>4<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"3nytya2vhkh5aryjglxs"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"38082638449"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"rnvzgby9hq0jpxnqx3gy"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913550-54-57 84:14:29"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"2006-03-12 11:50:44"</span><span class="o">)</span>
  RECORD: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>5<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"utsj9ng19wzg8mj27j38"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"22472851323"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"w5rlnpmv2t997zr2lv6r"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913550-54-91 39:58:61"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"2007-03-20 15:38:40"</span><span class="o">)</span>
</pre></td> </tr></tbody></table></code></pre></div> </div> <p>可以看到遍历主索引即是扫表了</p> <p>辅助索引</p> <div class="language-sh highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td> <td class="rouge-code"><pre>  innodb_space <span class="nt">-s</span> ibdata1 <span class="nt">-T</span> <span class="nb">test</span>/user_info <span class="nt">-I</span> idx_phone index-recurse
</pre></td> </tr></tbody></table></code></pre></div> </div> <p>输出</p> <div class="language-sh highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td> <td class="rouge-code"><pre>  RECORD: <span class="o">(</span><span class="nv">phone</span><span class="o">=</span><span class="s2">"04089308321"</span><span class="o">)</span> → <span class="o">(</span><span class="nb">id</span><span class="o">=</span>2<span class="o">)</span>
  RECORD: <span class="o">(</span><span class="nv">phone</span><span class="o">=</span><span class="s2">"22472851323"</span><span class="o">)</span> → <span class="o">(</span><span class="nb">id</span><span class="o">=</span>5<span class="o">)</span>
  RECORD: <span class="o">(</span><span class="nv">phone</span><span class="o">=</span><span class="s2">"33810132397"</span><span class="o">)</span> → <span class="o">(</span><span class="nb">id</span><span class="o">=</span>1<span class="o">)</span>
  RECORD: <span class="o">(</span><span class="nv">phone</span><span class="o">=</span><span class="s2">"38082638449"</span><span class="o">)</span> → <span class="o">(</span><span class="nb">id</span><span class="o">=</span>4<span class="o">)</span>
  RECORD: <span class="o">(</span><span class="nv">phone</span><span class="o">=</span><span class="s2">"79622320564"</span><span class="o">)</span> → <span class="o">(</span><span class="nb">id</span><span class="o">=</span>3<span class="o">)</span>
</pre></td> </tr></tbody></table></code></pre></div> </div> </li> <li> <p>查看索引层级数据信息</p> <div class="language-sh highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td> <td class="rouge-code"><pre>  innodb_space <span class="nt">-s</span> ibdata1 <span class="nt">-T</span> <span class="nb">test</span>/user_info2 <span class="nt">-I</span> PRIMARY <span class="nt">-l</span> 1 index-level-summary
</pre></td> </tr></tbody></table></code></pre></div> </div> <p>输出</p> <div class="language-sh highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td> <td class="rouge-code"><pre>  page  index   level   data    free    records min_key
  133     51      1       7888    8132    464     <span class="nb">id</span><span class="o">=</span>1
  134     51      1       15776   14      928     <span class="nb">id</span><span class="o">=</span>78796
  135     51      1       15776   14      928     <span class="nb">id</span><span class="o">=</span>236556
  138     51      1       15776   14      928     <span class="nb">id</span><span class="o">=</span>394316
  141     51      1       15776   14      928     <span class="nb">id</span><span class="o">=</span>552076
  142     51      1       15776   14      928     <span class="nb">id</span><span class="o">=</span>709836
  143     51      1       15776   14      928     <span class="nb">id</span><span class="o">=</span>867596
  145     51      1       15776   14      928     <span class="nb">id</span><span class="o">=</span>1025356
  149     51      1       15776   14      928     <span class="nb">id</span><span class="o">=</span>1183116
  150     51      1       15776   14      928     <span class="nb">id</span><span class="o">=</span>1340876
  151     51      1       15776   14      928     <span class="nb">id</span><span class="o">=</span>1498636
  152     51      1       15776   14      928     <span class="nb">id</span><span class="o">=</span>1656396
  154     51      1       15776   14      928     <span class="nb">id</span><span class="o">=</span>1814156
  156     51      1       15776   14      928     <span class="nb">id</span><span class="o">=</span>1971916
  161     51      1       15776   14      928     <span class="nb">id</span><span class="o">=</span>2129676
  164     51      1       15776   14      928     <span class="nb">id</span><span class="o">=</span>2287436
  165     51      1       3893    12247   229     <span class="nb">id</span><span class="o">=</span>2445196
</pre></td> </tr></tbody></table></code></pre></div> </div> <p>释义</p> <ul> <li>page:页号</li> <li>index:索引ID</li> <li>level:索引层级</li> <li>data:数据key</li> <li>free:当前页剩余空间</li> <li>records:当前页记录数</li> <li>min_key:当前页的最小key值</li> </ul> </li> </ul> </article> </div> <style>table{border-left:1px solid #000;border-top:1px solid #000;width:100%;word-wrap:break-word;word-break:break-all}table th{text-align:left;min-width:60px;max-width:300px}table th,td{border-right:1px solid #000;border-bottom:1px solid #000}</style> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 guan zhisong. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/devsong/devsong.github.io" target="_blank" rel="noopener noreferrer">devsong.github.io</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="noopener noreferrer">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script type="text/javascript">$(function(){$('[data-toggle="tooltip"]').tooltip()});</script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>