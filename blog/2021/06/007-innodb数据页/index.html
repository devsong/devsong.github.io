<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>innodb数据页分析 | devsong's website</title> <meta name="author" content="guan zhisong"/> <meta name="description" content="记录日常学习的代码、问题以及个人对相关技术的一些思考与见解 "/> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"/> <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚛️</text></svg>"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://devsong.github.io/blog/2021/06/007-innodb%E6%95%B0%E6%8D%AE%E9%A1%B5/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">devsong's website</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">关于</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">博客<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">github</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">个人简介</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">innodb数据页分析</h1> <p class="post-meta">June 5, 2021</p> <p class="post-tags"> <a href="/blog/2021"> <i class="fas fa-calendar fa-sm"></i> 2021 </a>   ·   <a href="/blog/tag/blogs"> <i class="fas fa-hashtag fa-sm"></i> blogs</a>   <a href="/blog/tag/mysql"> <i class="fas fa-hashtag fa-sm"></i> mysql</a>   <a href="/blog/tag/innodb"> <i class="fas fa-hashtag fa-sm"></i> innodb</a>   <a href="/blog/tag/page"> <i class="fas fa-hashtag fa-sm"></i> page</a>     ·   <a href="/blog/category/blogs"> <i class="fas fa-tag fa-sm"></i> blogs</a>   </p> </header> <article class="post-content"> <h4 id="innodb数据页分析">innodb数据页分析</h4> <p>在前面一系列介绍innodb文章里面多次提到数据页(page)的概念,鉴于数据页是底层ibd最小划分单位,表空间文件就是由一个又一个的页构成,因此页的重要性也就不言而喻,现在我们来具体分析innodb数据页的构成</p> <p>表空间文件在物理上以16KB为一个步进,Mysql磁盘IO的最小单位,回顾一下整体的表空间文件逻辑结构</p> <p><img src="/assets/img/mysql/innodb/index_file_segment_structure.jpeg" width="760" alt="index_file_segment_structure.jpeg"></p> <p>最底层的ibd物理文件按照16kb的维度划分为一个一个数据页(此处分析不包含page=0,1,2)等元数据信息控制页，想了解这部分内容的可以参考之前介绍的关于段、区的文章<a href="/blog/2021/06/005-Innodb%E8%A1%A8%E7%A9%BA%E9%97%B4-%E6%AE%B5-%E5%8C%BA%E6%8F%8F%E8%BF%B0%E9%A1%B5%E5%88%86%E6%9E%90%E4%B8%8E%E7%A3%81%E7%9B%98%E5%AD%98%E5%82%A8%E7%A9%BA%E9%97%B4%E7%AE%A1%E7%90%86/">段、区描述</a></p> <h3 id="照例来看看基础的索引页结构">照例来看看基础的索引页结构</h3> <p><img src="/assets/img/mysql/innodb/index_overview.jpeg" width="760" alt="index_overview.jpeg"></p> <ul> <li>FIL Header (38) 通常称之为文件头,这个所有的数据页均有此部分</li> <li>Index Header(36) 通常称之为页头</li> <li>Fseg Header(20) 段头,仅在索引页的根节点中设置</li> <li>System Records(26) 系统记录(infimum/supremum)</li> <li>User Records 用户记录</li> <li>Free Spaces 空闲空间</li> <li>Page Directory 页面目录槽</li> <li>FIL Trailer(8) 文件尾部</li> </ul> <h3 id="fil-headertrailer结构图">FIL HEADER/Trailer结构图</h3> <p><img src="/assets/img/mysql/innodb/fil_header.jpeg" width="760" alt="fil_header.jpeg"></p> <ul> <li>Checksum (4) 校验码</li> <li>Offset (Page Number) (4) 页号,亦即PageNo</li> <li>Previous Page (4) 前一页的页号</li> <li>Next Page (4) 后一页的页号</li> <li>LSN for last page modification (8) 最近一次修改page的lsn号</li> <li>Page Type (2) 数据页类型</li> <li>Flush LSN (0 except space 0 page 0) (8) 只用于系统表空间的第一个Page，记录在正常shutdown时安全checkpoint到的点，对于用户表空间，这个字段通常是空闲的</li> <li>Space ID (4) 表空间ID</li> </ul> <p>Fil Trailer</p> <ul> <li>Old-style Checksum (4) checksum,用于与header部分的checksum配合工作,检查数据页的完整性</li> <li>Low 32 bits of LSN (4) LSN的低位置4字节</li> </ul> <h4 id="index-header结构">Index Header结构</h4> <p><img src="/assets/img/mysql/innodb/index_header.jpeg" width="760" alt="index_header.jpeg"></p> <ul> <li>Number of Directory Slots (2) Page directory中的槽slot个数</li> <li>Heap Top Position (2) 指向当前Page内已使用的空间的末尾位置，即free space的开始位置</li> <li>Number of Heap Records / Format Flag (2) Page内所有记录个数(包含删除的),当第一个bit设置为1时，表示这个page内是以Compact格式存储的</li> <li>First Garbage Record Offset (2) 指向标记删除的记录链表的第一个记录</li> <li>Garbage Space (2) 被删除的记录链表上占用的总的字节数</li> <li>Last Insert Position (2) 指向最近一次插入的记录偏移量,主要用于优化顺序插入操作</li> <li>Page Direction (2) 用于指示当前记录的插入顺序以及是否正在进行顺序插入，插入时，PAGE_LAST_INSERT会和当前记录进行比较，以确认插入方向，据此进行插入优化</li> <li>Number of Inserts in Page Direction (2) 以相同方向的顺序插入记录个数</li> <li>Number of Records (2) Page上有效的未被标记删除的用户记录个数</li> <li>Maximum Transaction ID (8) 最近一次修改该page记录的事务ID</li> <li>Page Level (2) 该Page所在的btree level，根节点的level最大，叶子节点的level为0,非叶子节点以树形结构向上增长</li> <li>Index ID (8) 该Page归属的索引ID</li> </ul> <h4 id="fseg-header-结构">Fseg Header 结构</h4> <p><img src="/assets/img/mysql/innodb/fseg_header.jpeg" width="760" alt="fseg_header.jpeg"></p> <ul> <li>Leaf Pages Inode Space ID (4) 叶子节点的表空间ID</li> <li>Leaf Pages Inode Page Number (4) 叶子节点索引段的页号</li> <li>Leaf Pages Inode Offset (2) 叶子节点索引段entry偏移量(标示具体的inode segment entry 偏移)</li> <li>Internal (non-leaf) Inode Space ID (4) 非叶子节点的表空间ID</li> <li>Internal (non-leaf) Inode Page Number (4) 非叶子节点索引段的页号</li> <li>Internal (non-leaf) Inode Offset (2) 非叶子节点索引段entry偏移量(标示具体的inode segment entry 偏移)</li> </ul> <p>此部分内容值存在于数据页level是根节点(索引根节点)的数据页内</p> <h4 id="system-records-结构">System Records 结构</h4> <p><img src="/assets/img/mysql/innodb/system_records.jpeg" width="760" alt="system_records.jpeg"></p> <ul> <li>Info Flags (4 bits) 标记信息</li> <li>Number of Records Owned (4 bits) m_owned值,对于infimum 此值固定为1,下面介绍page slots会解释为什么是1</li> <li>Order (13 bits) 序号,一说为heap_number</li> <li>Record Type (3 bits) 记录类型</li> <li>Next Record Offset (2) 下一个记录的页内偏移位置</li> <li>“infimum\0” (8 byte) 固定”infimum”值</li> <li>Info Flags (4 bits) 标记信息</li> <li>Number of Records Owned (4 bits) m_owned值,对于supremum取值范围为1-8,</li> <li>Order (13 bits) 序号</li> <li>Record Type (3 bits) 记录类型</li> <li>Next Record Offset (2byte) 下一个记录的页内偏移位置</li> <li>“supremum” (8byte) 固定”supremum”值</li> </ul> <p>系统记录由innodb自动生成,无需开发人员干预</p> <ul> <li> <p>infimum代表当前页比最小记录还小的记录(用作链表的表头)</p> </li> <li> <p>supremum代表当前页比最大记录还大的记录(用作链表的表尾)</p> </li> </ul> <p>此处”最小/最大”记录都是相对于当前页来说的,并不是全局数据节点层面的最大最小记录,主要用于页内数据链表表头/表尾起始结束位置的比对,举个例子,当查询一个id不存在的数据项目时候,load数据页进内存，在内存里面使用2分法查找,找到infimum/supremum记录仍然没有找到指定id记录的时候，此时需要结束查找过程，返回id数据不存在的结果</p> <h4 id="user-records-用户记录free-space">User Records 用户记录/Free Space</h4> <p>这部分记录即为真实的用户记录存放区域/空闲空间</p> <h4 id="page-directory-页面目录槽">Page Directory 页面目录槽</h4> <p>前面提到过slots以及owned的概念,之前文章也提到过页面内容的查找是在内存中完成的,内存查找的方法有很多,常见的链表顺序遍历、有序数据结构的二分查找算法、hash查找,目录槽是一个稀疏数组，之前的文章提到过目录槽结构的命令</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td> <td class="rouge-code"><pre>innodb_space <span class="nt">-s</span> /usr/local/var/mysql/ibdata1 <span class="nt">-T</span> <span class="nb">test</span>/user_info2 <span class="nt">-p</span> 6 page-directory-summary 
</pre></td> </tr></tbody></table></code></pre></div></div> <p>输出:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre></td> <td class="rouge-code"><pre>slot    offset  <span class="nb">type          </span>owned   key
0       99      infimum       1
1       395     conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>89<span class="o">)</span>
2       751     conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>93<span class="o">)</span>
3       1107    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>97<span class="o">)</span>
4       1463    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>101<span class="o">)</span>
5       1819    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>105<span class="o">)</span>
6       2175    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>109<span class="o">)</span>
7       2531    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>113<span class="o">)</span>
8       2887    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>117<span class="o">)</span>
9       3243    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>121<span class="o">)</span>
10      3599    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>125<span class="o">)</span>
11      3955    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>129<span class="o">)</span>
12      4311    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>133<span class="o">)</span>
13      4667    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>137<span class="o">)</span>
14      5023    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>141<span class="o">)</span>
15      5379    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>145<span class="o">)</span>
16      5735    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>149<span class="o">)</span>
17      6091    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>153<span class="o">)</span>
18      6447    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>157<span class="o">)</span>
19      6803    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>161<span class="o">)</span>
20      7159    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>165<span class="o">)</span>
21      7515    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>169<span class="o">)</span>
22      7871    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>173<span class="o">)</span>
23      8227    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>177<span class="o">)</span>
24      8583    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>181<span class="o">)</span>
25      8939    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>185<span class="o">)</span>
26      9295    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>189<span class="o">)</span>
27      9651    conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>193<span class="o">)</span>
28      10007   conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>197<span class="o">)</span>
29      10363   conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>201<span class="o">)</span>
30      10719   conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>205<span class="o">)</span>
31      11075   conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>209<span class="o">)</span>
32      11431   conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>213<span class="o">)</span>
33      11787   conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>217<span class="o">)</span>
34      12143   conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>221<span class="o">)</span>
35      12499   conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>225<span class="o">)</span>
36      12855   conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>229<span class="o">)</span>
37      13211   conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>233<span class="o">)</span>
38      13567   conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>237<span class="o">)</span>
39      13923   conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>241<span class="o">)</span>
40      14279   conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>245<span class="o">)</span>
41      14635   conventional  4       <span class="o">(</span><span class="nb">id</span><span class="o">=</span>249<span class="o">)</span>
42      112     supremum      7	
</pre></td> </tr></tbody></table></code></pre></div></div> <p>这是pageno=6的数据页槽内容,下面这个可以查看<code class="language-plaintext highlighter-rouge">pageno=6</code>的数据页内容</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td> <td class="rouge-code"><pre>innodb_space <span class="nt">-s</span> /usr/local/var/mysql/ibdata1 <span class="nt">-T</span> <span class="nb">test</span>/user_info2 <span class="nt">-p</span> 6 page-records 
</pre></td> </tr></tbody></table></code></pre></div></div> <p>输出,内容较多，此处只列出了部分内容(含头、尾数据):</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td> <td class="rouge-code"><pre>Record 128: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>86<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"c6u0olu1t99bintxuwju"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"00140889180"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"unmg3kktfcfaybsclinz"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913571-04-58 64:37:75"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"1997-02-26 10:06:12"</span><span class="o">)</span>
Record 217: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>87<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"b6zlukjvcijclmtsm61c"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"73416452518"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"fxtqhwklqfvri0wximdg"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913571-04-92 19:82:07"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"1998-03-21 18:46:44"</span><span class="o">)</span>
Record 306: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>88<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"lwoh05cclf8x5i8mg2g4"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"23970977406"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"cmopy6gxavhwnbbhsiwh"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913571-05-25 75:26:39"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"1999-04-14 03:27:16"</span><span class="o">)</span>
Record 395: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>89<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"s3hesywuyuiifugxufhk"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"27097768320"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"ta3nac9mgrjp1s5vbx7x"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913571-05-59 30:70:71"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"2000-05-06 12:07:48"</span><span class="o">)</span>
Record 484: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>90<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"cchc4lnf4dfybc2qpk52"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"64290362245"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"zyrwthg7pxjnqjuda1r0"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913571-05-92 86:15:03"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"2001-05-29 20:48:20"</span><span class="o">)</span>
Record 573: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>91<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"xvl8gicmu3ls3kperbdk"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"68101472060"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"b6apbvpuoopi9rasmjio"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913571-06-26 41:59:35"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"2002-06-22 05:28:52"</span><span class="o">)</span>
Record 662: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>92<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"t7kfqinv3nyssli3dipm"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"17411298527"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"rwrbhq8ghahwn9vrfako"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913571-06-59 97:03:67"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"2003-07-15 14:09:24"</span><span class="o">)</span>
Record 751: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>93<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"huflr7sogkmuye4va97y"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"25370775440"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"x29tkcz5zrk9crfkplan"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913571-06-93 52:47:99"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"2004-08-06 22:49:56"</span><span class="o">)</span>
Record 840: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>94<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"dnbl0r6ntriomk8vye1i"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"00944807720"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"qkygjoppuqx1kqxot6jb"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913571-07-27 07:92:31"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"2005-08-30 07:30:28"</span><span class="o">)</span>

....

Record 14546: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>248<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"bgf9zgtnjhjzjncarogy"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"73579774944"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"xo5pj2mgtfo3wmqzf5xg"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913571-62-97 11:49:44"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"2033-04-22 17:04:20"</span><span class="o">)</span>
Record 14635: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>249<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"yodufhkpu7i57akwb18t"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"61058341505"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"wljt1vkznox6i7gpdrno"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913571-63-30 66:93:76"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"2034-05-16 01:44:52"</span><span class="o">)</span>
Record 14724: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>250<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"hay9tqm9wx5pcht6weca"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"83173571461"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"ygjmimuafb3klyb9px1l"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913571-63-64 22:38:08"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"2035-06-08 10:25:24"</span><span class="o">)</span>
Record 14813: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>251<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"tdvgmgsdjiwfzwo7xgjz"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"69997944082"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"bjf0pxbum1e1yfe1f1co"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913571-63-97 77:82:40"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"2036-06-30 19:05:56"</span><span class="o">)</span>
Record 14902: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>252<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"fhyvivjbvgudqmnbknx7"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"77376965702"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"4zcwekwqqh5aolmahcn0"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913571-64-31 33:26:72"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"2037-07-24 03:46:28"</span><span class="o">)</span>
Record 14991: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>253<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"tdrqgvp9k231kxgxm62i"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"11097938259"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"wzf5xgawn1wqmpnao3ud"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913571-64-64 88:71:04"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"2038-08-16 12:27:00"</span><span class="o">)</span>
Record 15080: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>254<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"cdgzudipzxbd8qhnj57a"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"16963982701"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"zpfa4pg1vp68extfvoh2"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913571-64-98 44:15:36"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"2039-09-08 21:07:32"</span><span class="o">)</span>
Record 15169: <span class="o">(</span><span class="nb">id</span><span class="o">=</span>255<span class="o">)</span> → <span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s2">"bexa9qcpzzlt3pjgyto7"</span>, <span class="nv">phone</span><span class="o">=</span><span class="s2">"17514550564"</span>, <span class="nv">email</span><span class="o">=</span><span class="s2">"fjlf6mkr3ogq1omxba5p"</span>, <span class="nv">create_time</span><span class="o">=</span><span class="s2">"184913571-65-31 99:59:68"</span>, <span class="nv">update_time</span><span class="o">=</span><span class="s2">"2040-09-16 00:55:28"</span><span class="o">)</span>
</pre></td> </tr></tbody></table></code></pre></div></div> <ul> <li> <p>可以看到infimum的 owned 值为1,因为infimum前面没有数据记录, infimum为第一条记录,owned只包含它自己</p> </li> <li> <p>id=89 的槽owned值为4，我们看记录可以知道,它前面的数据有id=86,87,88,算上自己89，总共四个值</p> </li> <li> <p>supremum 的owned值7，我们知道上一个槽的key值为249，从记录列表里面可以看到supremum之前有id=250,251,252,253,254,255 共六条记录,算上自己一共七条记录</p> </li> </ul> <h5 id="数据槽记录的逻辑结构">数据槽/记录的逻辑结构</h5> <p><img src="/assets/img/mysql/innodb/user_records.jpeg" width="760" alt="user_records.jpeg"></p> <p>可以看到底层数据行之间顺序关系是链式结构,目录槽记录的是offset(页内偏移),key值为主键ID(对于主索引来说,对于辅助索引的节点key值为对应的辅助索引内容),顺带提一下,数据槽的内容按照offset中对应的key值有序,而非offset排序</p> <p>综上,owned值将页内数据id按照一定的规则，划分为一个一个的区块,构成一个稀疏的数组,每个owned的区间描述是”( ]”前开后闭形式的，描述在此之前有多少个记录,页内数据查找先根据槽信息作二分查找,然后通过链表遍历的方式在区间内做数据最后一层的查找定位</p> </article> </div> <style>table{border-left:1px solid #000;border-top:1px solid #000;width:100%;word-wrap:break-word;word-break:break-all}table th{text-align:left;min-width:60px;max-width:300px}table th,td{border-right:1px solid #000;border-bottom:1px solid #000}</style> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 guan zhisong. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/devsong/devsong.github.io" target="_blank" rel="noopener noreferrer">devsong.github.io</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="noopener noreferrer">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script type="text/javascript">$(function(){$('[data-toggle="tooltip"]').tooltip()});</script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>