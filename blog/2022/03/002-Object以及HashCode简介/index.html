<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Object以及HashCode简介 | devsong's website</title> <meta name="author" content="guan zhisong"/> <meta name="description" content="记录日常学习的代码、问题以及个人对相关技术的一些思考与见解 "/> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"/> <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚛️</text></svg>"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://devsong.github.io/blog/2022/03/002-Object%E4%BB%A5%E5%8F%8AHashCode%E7%AE%80%E4%BB%8B/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">devsong's website</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">关于</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">博客<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">github</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">个人简介</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Object以及HashCode简介</h1> <p class="post-meta">March 30, 2022</p> <p class="post-tags"> <a href="/blog/2022"> <i class="fas fa-calendar fa-sm"></i> 2022 </a>   ·   <a href="/blog/tag/blogs"> <i class="fas fa-hashtag fa-sm"></i> blogs</a>   <a href="/blog/tag/java"> <i class="fas fa-hashtag fa-sm"></i> java</a>   <a href="/blog/tag/string"> <i class="fas fa-hashtag fa-sm"></i> string</a>   <a href="/blog/tag/hashcode"> <i class="fas fa-hashtag fa-sm"></i> hashCode</a>     ·   <a href="/blog/category/blogs"> <i class="fas fa-tag fa-sm"></i> blogs</a>   </p> </header> <article class="post-content"> <h2 id="hash简介以及java-hashcode的用途">Hash简介以及Java HashCode的用途</h2> <p>Hash俗称散列,在不同的语言中有不同的别名,学过数据结构的同学对此应该不陌生,最简单的hash算法取模如下</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td> <td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashAlg</span><span class="o">(</span><span class="kt">int</span> <span class="n">origin</span><span class="o">){</span>
    <span class="k">return</span> <span class="n">origin</span> <span class="o">%</span> <span class="mi">10</span><span class="o">;</span>
<span class="o">}</span>
</pre></td> </tr></tbody></table></code></pre></div></div> <p>将输入的参数对一个特定的数取模,得到一个<code class="language-plaintext highlighter-rouge">特征值</code>，得到的那个值即为通常意义上的散列值(hashCode), 相较于传统的通过key查找数据，散列表/hash表查找数据的方式通常需要将key进行一定的运算，得到hash值,然后用hash值进行定位查找数据, 通常意义上的散列算法的时间复杂度为O(1),这也是为什么散列如此常见与流行的一个原因</p> <p>众所周知，Java的<code class="language-plaintext highlighter-rouge">Object</code>类是所有的类型的基类,Object中的方法列表如下:</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td> <td class="rouge-code"><pre> <span class="kd">public</span> <span class="nf">Object</span><span class="o">()</span> <span class="o">{}</span>

 <span class="kd">public</span> <span class="kd">final</span> <span class="kd">native</span> <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">getClass</span><span class="o">();</span>

 <span class="kd">public</span> <span class="kd">native</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">();</span>

 <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">obj</span><span class="o">);</span>
 <span class="o">}</span>

 <span class="kd">protected</span> <span class="kd">native</span> <span class="nc">Object</span> <span class="nf">clone</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">CloneNotSupportedException</span><span class="o">;</span>

 <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"@"</span> <span class="o">+</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">toHexString</span><span class="o">(</span><span class="n">hashCode</span><span class="o">());</span>
 <span class="o">}</span>

 <span class="kd">public</span> <span class="kd">final</span> <span class="kd">native</span> <span class="kt">void</span> <span class="nf">notify</span><span class="o">();</span>

 <span class="kd">public</span> <span class="kd">final</span> <span class="kd">native</span> <span class="kt">void</span> <span class="nf">notifyAll</span><span class="o">();</span>

 <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">wait</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
    <span class="n">wait</span><span class="o">(</span><span class="mi">0L</span><span class="o">);</span>
 <span class="o">}</span>

 <span class="kd">public</span> <span class="kd">final</span> <span class="kd">native</span> <span class="kt">void</span> <span class="nf">wait</span><span class="o">(</span><span class="kt">long</span> <span class="n">timeoutMillis</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span><span class="o">;</span>

 <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">wait</span><span class="o">(</span><span class="kt">long</span> <span class="n">timeoutMillis</span><span class="o">,</span> <span class="kt">int</span> <span class="n">nanos</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">timeoutMillis</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"timeoutMillis value is negative"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">nanos</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">nanos</span> <span class="o">&gt;</span> <span class="mi">999999</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"nanosecond timeout value out of range"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">nanos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">timeoutMillis</span><span class="o">++;</span>
    <span class="o">}</span>

    <span class="n">wait</span><span class="o">(</span><span class="n">timeoutMillis</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">finalize</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Throwable</span> <span class="o">{</span> <span class="o">}</span>
</pre></td> </tr></tbody></table></code></pre></div></div> <p>可以看到，里面的大部分方法均为native方法,非native的方法除去equals方法，均为直接或者间接的调用了native的方法,默认的<code class="language-plaintext highlighter-rouge">toString</code>方法的实现也用到了hashCode方法, 本章的主角咋们来说说<code class="language-plaintext highlighter-rouge">equals</code>与<code class="language-plaintext highlighter-rouge">hashCode</code>这两个方法</p> <h3 id="一个老生常谈的问题">一个老生常谈的问题</h3> <p>大家在初学Java这门编程语言的时候,经常被问到的一个问题就是<code class="language-plaintext highlighter-rouge">equals</code>与<code class="language-plaintext highlighter-rouge">==</code>在比较对象时候有什么异同,String对象的<code class="language-plaintext highlighter-rouge">equals</code>与<code class="language-plaintext highlighter-rouge">==</code>之间的区别, 进一步的知识点可能会被问到<code class="language-plaintext highlighter-rouge">Byte</code>这类冷门点的话题,诸如以下代码</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td> <td class="rouge-code"><pre><span class="nc">String</span> <span class="n">abc</span> <span class="o">=</span> <span class="s">"abc"</span><span class="o">;</span>
<span class="nc">String</span> <span class="n">abcObj</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="s">"abc"</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">abc</span> <span class="o">==</span> <span class="s">"abc"</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">abc</span> <span class="o">==</span> <span class="n">abcObj</span><span class="o">);</span>
</pre></td> </tr></tbody></table></code></pre></div></div> <p>众所周知，Java并不支持操作符重载,关于<code class="language-plaintext highlighter-rouge">==</code>比较的永远是两个对象的地址,想要实现C++中的操作符重载的效果，需要自己编码(编写方法)实现对应的功能,<code class="language-plaintext highlighter-rouge">equals</code>方法为Object的方法, 默认的<code class="language-plaintext highlighter-rouge">equals</code>方法比较的是两个对象的内存地址,<code class="language-plaintext highlighter-rouge">equals</code>方法可以被子类重写,对应的hashCode也可以被重写,事实上这俩要重写的话通常是需要成对进行重写</p> <p>那么，hashCode与内存地址有什么关系,事实上在现今JDK版本(JDK8往上)这俩并没有实质性的关系，可以认为是两个完全不同的东西，</p> <p><img src="/assets/img/java/string/address.jpg" width="760" height="500" alt="address"></p> <ul> <li> <p>内存地址在程序的进程地址空间中是唯一的,内存由系统按需分配，故内存地址的值通常是不可预知的</p> </li> <li> <p>默认的<code class="language-plaintext highlighter-rouge">hashCode</code>实现由JVM底层的Native方法实现,感兴趣的同学可以参见OpenJdk中关于hashCode实现的部分,对应的代码仓库如下 <a href="https://github.com/openjdk/jdk" target="_blank" rel="noopener noreferrer">https://github.com/openjdk/jdk</a></p> </li> </ul> <p>对应的实现代码如下(可能需要切换分支,下述代码在jdk11的系列分支是存在的，文件名为synchronizer.cpp):</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre></td> <td class="rouge-code"><pre><span class="k">static</span> <span class="kr">inline</span> <span class="kt">intptr_t</span> <span class="nf">get_next_hash</span><span class="p">(</span><span class="n">Thread</span> <span class="o">*</span> <span class="n">Self</span><span class="p">,</span> <span class="n">oop</span> <span class="n">obj</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">intptr_t</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">hashCode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This form uses global Park-Miller RNG.</span>
    <span class="c1">// On MP system we'll have lots of RW access to a global, so the</span>
    <span class="c1">// mechanism induces lots of coherency traffic.</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">os</span><span class="o">::</span><span class="n">random</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">hashCode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This variation has the property of being stable (idempotent)</span>
    <span class="c1">// between STW operations.  This can be useful in some of the 1-0</span>
    <span class="c1">// synchronization schemes.</span>
    <span class="kt">intptr_t</span> <span class="n">addrBits</span> <span class="o">=</span> <span class="n">cast_from_oop</span><span class="o">&lt;</span><span class="kt">intptr_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">addrBits</span> <span class="o">^</span> <span class="p">(</span><span class="n">addrBits</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">^</span> <span class="n">GVars</span><span class="p">.</span><span class="n">stwRandom</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">hashCode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>            <span class="c1">// for sensitivity testing</span>
  <span class="p">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">hashCode</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">value</span> <span class="o">=</span> <span class="o">++</span><span class="n">GVars</span><span class="p">.</span><span class="n">hcSequence</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">hashCode</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">cast_from_oop</span><span class="o">&lt;</span><span class="kt">intptr_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Marsaglia's xor-shift scheme with thread-specific state</span>
    <span class="c1">// This is probably the best overall implementation -- we'll</span>
    <span class="c1">// likely make this the default in future releases.</span>
    <span class="kt">unsigned</span> <span class="n">t</span> <span class="o">=</span> <span class="n">Self</span><span class="o">-&gt;</span><span class="n">_hashStateX</span><span class="p">;</span>
    <span class="n">t</span> <span class="o">^=</span> <span class="p">(</span><span class="n">t</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">);</span>
    <span class="n">Self</span><span class="o">-&gt;</span><span class="n">_hashStateX</span> <span class="o">=</span> <span class="n">Self</span><span class="o">-&gt;</span><span class="n">_hashStateY</span><span class="p">;</span>
    <span class="n">Self</span><span class="o">-&gt;</span><span class="n">_hashStateY</span> <span class="o">=</span> <span class="n">Self</span><span class="o">-&gt;</span><span class="n">_hashStateZ</span><span class="p">;</span>
    <span class="n">Self</span><span class="o">-&gt;</span><span class="n">_hashStateZ</span> <span class="o">=</span> <span class="n">Self</span><span class="o">-&gt;</span><span class="n">_hashStateW</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="n">v</span> <span class="o">=</span> <span class="n">Self</span><span class="o">-&gt;</span><span class="n">_hashStateW</span><span class="p">;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="o">^</span> <span class="p">(</span><span class="n">v</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">))</span> <span class="o">^</span> <span class="p">(</span><span class="n">t</span> <span class="o">^</span> <span class="p">(</span><span class="n">t</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">));</span>
    <span class="n">Self</span><span class="o">-&gt;</span><span class="n">_hashStateW</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">value</span> <span class="o">&amp;=</span> <span class="n">markOopDesc</span><span class="o">::</span><span class="n">hash_mask</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">value</span> <span class="o">=</span> <span class="mh">0xBAD</span><span class="p">;</span>
  <span class="n">assert</span><span class="p">(</span><span class="n">value</span> <span class="o">!=</span> <span class="n">markOopDesc</span><span class="o">::</span><span class="n">no_hash</span><span class="p">,</span> <span class="s">"invariant"</span><span class="p">);</span>
  <span class="n">TEVENT</span><span class="p">(</span><span class="n">hashCode</span><span class="o">:</span> <span class="n">GENERATE</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">value</span><span class="p">;</span>
<span class="p">}</span>
</pre></td> </tr></tbody></table></code></pre></div></div> <p>可以看到,native的实现总共有6种,从上往下的类型编号分别为0-5,依次排序,</p> <ul> <li>0:调用os::random() 生成hashCode，亦即使用一个随机值做hashCode</li> <li>1:内存地址做移位操作,然后与steRandom(随机数)做异或操作</li> <li>2:固定值1</li> <li>3:自增序列</li> <li>4:使用对象的内存地址</li> <li>5:当前线程中的四个数字(实际上是一个随机数+三个确定值)运用xorshift随机数算法得到的一个随机数</li> </ul> <p>默认的实现为5,亦即上述列表中的最后一个,从注释中也可以看到此算法作者的本意在将来的版本中会成为默认的hashCode实现,实际上由于这部分代码提交历史比较久了，此实现现在已经成为了默认的实现,对于上述规则中1和4，hashCode的计算确实与内存地址有一定的关系,早期版本的JDK实现是否采用此实现暂未考究,也不在系列讨论的范畴中</p> <p>thread.cpp中关于线程threadState x y z w的四个值的初始化如下:</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td> <td class="rouge-code"><pre>  <span class="c1">// thread-specific hashCode stream generator state - Marsaglia shift-xor form</span>
  <span class="n">_hashStateX</span> <span class="o">=</span> <span class="nl">os:</span><span class="o">:</span><span class="n">random</span><span class="o">();</span>
  <span class="n">_hashStateY</span> <span class="o">=</span> <span class="mi">842502087</span><span class="o">;</span>
  <span class="n">_hashStateZ</span> <span class="o">=</span> <span class="mh">0x8767</span><span class="o">;</span>    <span class="c1">// (int)(3579807591LL &amp; 0xffff) ;</span>
  <span class="n">_hashStateW</span> <span class="o">=</span> <span class="mi">273326509</span><span class="o">;</span>
</pre></td> </tr></tbody></table></code></pre></div></div> <p>可以看到上述值除开x外,y z w三个值均为固定值(通常又称之为MagicNumber),下述代码为测试代码，可以测试默认的hashCode实现</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td> <td class="rouge-code"><pre> <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="nc">Object</span> <span class="n">mainHashObj</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">();</span>
    <span class="nc">String</span> <span class="n">info</span> <span class="o">=</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"toString:%s,hex:%s,hashCode:%s"</span><span class="o">,</span> <span class="n">mainHashObj</span><span class="o">,</span> 	<span class="nc">Integer</span><span class="o">.</span><span class="na">toHexString</span><span class="o">(</span><span class="n">mainHashObj</span><span class="o">.</span><span class="na">hashCode</span><span class="o">()),</span> <span class="n">mainHashObj</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">info</span><span class="o">);</span>
 <span class="o">}</span>
</pre></td> </tr></tbody></table></code></pre></div></div> <p>注意，编译运行上述代码需要加上jvm参数 <code class="language-plaintext highlighter-rouge">-XX:+UnlockExperimentalVMOptions -XX:hashCode=2</code> 参数,不然会使用jdk默认的hashCode算法实现,下面是这俩参数的解释:</p> <ul> <li>UnlockExperimentalVMOptions 解锁专家模式</li> <li>hashCode=2 配置那种hash算法为默认的,此处的2即为上述列表中的0-5，具体含义参见上述解释，不在赘述</li> </ul> <p>可以手动修改hashCode的值,重复运行上述代码，观察默认的hashCode值的变化情况从而验证</p> </article> </div> <style>table{border-left:1px solid #000;border-top:1px solid #000;width:100%;word-wrap:break-word;word-break:break-all}table th{text-align:left;min-width:60px;max-width:300px}table th,td{border-right:1px solid #000;border-bottom:1px solid #000}</style> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 guan zhisong. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/devsong/devsong.github.io" target="_blank" rel="noopener noreferrer">devsong.github.io</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="noopener noreferrer">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script type="text/javascript">$(function(){$('[data-toggle="tooltip"]').tooltip()});</script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>